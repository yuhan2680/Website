<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>å°æ¶µNaiwenelã®ä¸ªäººç½‘ç«™</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- åœ†æ¶¦å­—ä½“ -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css"/>
</head>

<body class="light">

  <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
  <canvas id="star-canvas"></canvas>

  <!-- å¯¼èˆªæ  -->
  <nav class="menu-nav">
    <div class="menu-container">

      <!-- Logo -->
      <div class="menu-logo"><a href="index.html">å°æ¶µNaiwenel</a></div>

      <!-- åŠŸèƒ½åŒºåŸŸï¼šå¯¼èˆªæ å’Œä¸»é¢˜åˆ‡æ¢ -->
      <div class="menu-function">
        <!-- æ±‰å ¡æŒ‰é’®ï¼ˆç§»åŠ¨ç«¯å¯è§ï¼‰ -->
        <div class="hamburger" id="hamburger">
          â˜°
        </div>
  
        <!-- å¯¼èˆªèœå• -->
        <ul class="menu-list" id="menuList">
          <li><a href="index.html" class="menu-item active">é¦–é¡µ</a></li>
          <li><a href="blog.html" class="menu-item">åšå®¢åˆ—è¡¨</a></li>
          <li><a href="about.html" class="menu-item">å…³äºæˆ‘</a></li>
          <li><a href="friendlinks.html" class="menu-item">å‹æƒ…é“¾æ¥</a></li>
        </ul>
  
        <!-- å¤œé—´æ¨¡å¼åˆ‡æ¢ -->
        <div class="night-toggle" id="nightToggle">ğŸŒ™</div>
  
        </div>
      </div>
  </nav>


  <!-- Banner -->
  <div class="banner">
    <h1>æ¬¢è¿æ¥åˆ°å°æ¶µã®ä¸ªäººç½‘ç«™ âœ¨</h1>
    <p>ä¸ªäººåŠ¿ Vup / å¼€æºç‹¬ç«‹æ¸¸æˆå¼€å‘è€…</p>
  </div>
  
  <!-- å†…å®¹å¡ç‰‡ -->
  <div class="section">
    <h2><a class="post-title" href="donate.html">èµåŠ©ä½œè€…</a></h2>
  </div>

  <!-- å†…å®¹å¡ç‰‡ -->
  <div class="section">
    <h2>ğŸ“ æœ€æ–°æ–‡ç« </h2>
    <ul class="post-list">
      <li>
        <a class="post-title" href="posts/post1.html">ç¬¬ä¸€ç¯‡æ–‡ç« </a>
        <span class="post-date">2025-11-20</span>
      </li>
    </ul>
  </div>

    <!-- ===== ç•™è¨€æ¿ ===== -->
  <div class="comment-container">
    <h2 class="comment-title">ğŸ’¬ ç•™è¨€æ¿</h2>

    <!-- è¾“å…¥æ¡† -->
    <div class="comment-input-card glass-box">
      <input id="nickname" class="glass-input" placeholder="æ˜µç§°ï¼ˆå¿…å¡«ï¼‰">
      <textarea id="comment" class="glass-textarea" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..."></textarea>
      <button id="sendComment" class="glass-button">æäº¤è¯„è®º</button>
    </div>

    <!-- è¯„è®ºåˆ—è¡¨ -->
    <div id="commentList" class="comment-list glass-box">
      æ­£åœ¨åŠ è½½è¯„è®º...
    </div>
  </div>

  <div id="backToTop">â†‘</div>

  <!-- æ˜Ÿçˆ†+æ³¢çº¹+å°¾è¿¹ -->
  <script>
    const canvas = document.getElementById("star-canvas");
    const ctx = canvas.getContext("2d");

    let stars = [], bursts = [], rings = [];
    let w, h;
    let mouse = { x: null, y: null };

    /* å¤œé—´æ¨¡å¼æŒ‰é’® */
    const toggleBtn = document.getElementById("nightToggle");
    toggleBtn.onclick = () => {
      if (document.body.classList.contains("light")) {
        document.body.classList.replace("light", "night");
        toggleBtn.textContent = "â˜€ï¸";
      } else {
        document.body.classList.replace("night", "light");
        toggleBtn.textContent = "ğŸŒ™";
      }
    };

    /* ç”»å¸ƒç¼©æ”¾ */
    function resize() {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight;
    }
    window.onresize = resize;
    resize();

    /* åˆå§‹åŒ–æ˜Ÿç©ºç²’å­ */
    function initStars() {
      stars = [];
      for (let i = 0; i < 130; i++) {
        stars.push({
          x: Math.random() * w,
          y: Math.random() * h,
          r: Math.random() * 1.3 + 0.4,
          dx: (Math.random() - 0.5) * 0.15,
          dy: (Math.random() - 0.5) * 0.15,
          color: Math.random() > 0.5 ? "#2ec7c9" : "#2970ea"
        });
      }
    }

    /* é¼ æ ‡å¸å¼• */
    window.addEventListener("mousemove", e => {
      mouse.x = e.clientX;
      mouse.y = e.clientY;
    });
    window.addEventListener("mouseleave", () => {
      mouse.x = null;
    });

    /* ç‚¹å‡»äº‹ä»¶ï¼šæ˜Ÿçˆ† & æ‰©æ•£æ³¢çº¹ */
    window.addEventListener("mousedown", createBurst);
    window.addEventListener("touchstart", e => {
      const t = e.touches[0];
      createBurst({ clientX: t.clientX, clientY: t.clientY });
    });

    function createBurst(e) {
      const x = e.clientX, y = e.clientY;

      for (let i = 0; i < 14; i++) {
        bursts.push({
          x: x,
          y: y,
          r: Math.random() * 3 + 2,
          dx: (Math.random() - 0.5) * 4,
          dy: (Math.random() - 0.5) * 4,
          life: 1,
          color: Math.random() > 0.5 ? "#2ec7c9" : "#2970ea",
          trail: []
        });
      }

      rings.push({ x: x, y: y, r: 0, alpha: 0.85 });
    }

    /* çˆ†ç‚¸ç²’å­ï¼ˆå«å°¾è¿¹ï¼‰ */
    function drawBursts() {
      for (let i = bursts.length - 1; i >= 0; i--) {
        let b = bursts[i];

        /* å°¾è¿¹ç‚¹ */
        b.trail.push({ x: b.x, y: b.y, alpha: b.life });
        if (b.trail.length > 10) b.trail.shift();

        for (let t of b.trail) {
          ctx.beginPath();
          ctx.arc(t.x, t.y, 1.2, 0, Math.PI * 2);
          ctx.fillStyle = b.color + Math.floor(t.alpha * 255).toString(16).padStart(2, "0");
          ctx.fill();
        }

        /* ä¸»ç²’å­ */
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.r, 0, Math.PI * 2);
        ctx.fillStyle = b.color + Math.floor(b.life * 255).toString(16).padStart(2, "0");
        ctx.fill();

        b.x += b.dx;
        b.y += b.dy;
        b.dy += 0.03;
        b.life -= 0.02;
        b.r *= 0.97;

        if (b.life <= 0 || b.r < 0.3) bursts.splice(i, 1);
      }
    }

    /* éŸ³æ¸¸æ‰©æ•£å…‰åœˆ */
    function drawRings() {
      for (let i = rings.length - 1; i >= 0; i--) {
        let r = rings[i];

        ctx.beginPath();
        ctx.arc(r.x, r.y, r.r, 0, Math.PI * 2);
        ctx.strokeStyle = "rgba(0,200,255," + r.alpha + ")";
        ctx.lineWidth = 3;
        ctx.stroke();

        r.r += 2.3;
        r.alpha -= 0.02;

        if (r.alpha <= 0) rings.splice(i, 1);
      }
    }

    /* ä¸»ç»˜åˆ¶å¾ªç¯ */
    function draw() {
      ctx.clearRect(0, 0, w, h);

      /* æ˜Ÿç©ºç²’å­ */
      for (let s of stars) {
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.r, 0, Math.PI * 2);
        ctx.fillStyle = s.color + "AA";
        ctx.fill();

        s.x += s.dx;
        s.y += s.dy;

        /* é¼ æ ‡å¸å¼• */
        if (mouse.x !== null) {
          const dx = mouse.x - s.x;
          const dy = mouse.y - s.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < 150) {
            s.x += dx * 0.015;
            s.y += dy * 0.015;
          }
        }

        /* è¶…å‡ºé‡ç½® */
        if (s.x < 0 || s.x > w || s.y < 0 || s.y > h) {
          s.x = Math.random() * w;
          s.y = Math.random() * h;
        }
      }

      drawBursts(); /* çˆ†ç‚¸ */
      drawRings();  /* æ³¢çº¹ */

      requestAnimationFrame(draw);
    }

    
    /* ===== è¿”å›é¡¶éƒ¨æŒ‰é’® ===== */
    const backToTop = document.getElementById("backToTop");

    // ç›‘å¬æ»šåŠ¨æ˜¾ç¤ºæŒ‰é’®
    window.addEventListener("scroll", () => {
      if (window.scrollY > 200) {
        backToTop.classList.add("show");
      } else {
        backToTop.classList.remove("show");
      }
    });

    // ç‚¹å‡»å¹³æ»‘å›é¡¶éƒ¨
    backToTop.onclick = () => {
      window.scrollTo({
        top: 0,
        behavior: "smooth"
      });
    };

    // è·å–å½“å‰æ–‡ç«  IDï¼šä¾‹å¦‚ /posts/post0.html â†’ post0
    let postId = location.pathname.split("/").pop().replace(".html", "");
    if(!postId){
      postId = 'index';
    }
    // æœ€å°æäº¤é—´éš”ï¼ˆæ¯«ç§’ï¼‰
    const MIN_INTERVAL = 3000;
    let lastSubmitTime = 0;

    // å®šä¹‰åŠ è½½è¯„è®ºçš„å‡½æ•°
    function loadComments() {
      // API å‘é€ GET è¯·æ±‚ï¼Œè·å–å½“å‰æ–‡ç« çš„æ‰€æœ‰è¯„è®ºï¼Œæœ¬éƒ¨åˆ†ä¸ä½œä¿®æ”¹
      fetch(`/api/comments?post=${postId}`)
        .then(res => res.json())
        .then(data => {
          const commentList = document.getElementById("commentList");

          // å¦‚æœæ²¡æœ‰è¯„è®ºï¼Œç”¨ textContent ç›´æ¥æ˜¾ç¤ºæ–‡æœ¬
          if (!data.length) {
            commentList.textContent = "æš‚æ— è¯„è®º";
            return;
          }

          // å¦‚æœæœ‰è¯„è®ºï¼Œå…ˆæ¸…ç©º div çš„æ‰€æœ‰å†…å®¹ï¼Œç„¶åé€æ¡æ„å»º DOM å…ƒç´ 
          commentList.innerHTML = ""; // æ¸…ç©ºä¹‹å‰çš„å†…å®¹ï¼Œä¿è¯ div å†…éƒ¨æ˜¯ç©ºçš„

          data.forEach(c => {
            // åˆ›å»ºå¤–å±‚div.comment-item
            const itemDiv = document.createElement("div");
            itemDiv.className = "comment-item";

            // åˆ›å»ºdiv.comment-nick
            const nickDiv = document.createElement("div");
            nickDiv.className = "comment-nick";
            nickDiv.textContent = c.nickname; // ä½¿ç”¨ textContent å®‰å…¨è®¾ç½®æ˜µç§°

            // åˆ›å»ºdiv.comment-content
            const contentDiv = document.createElement("div");
            contentDiv.className = "comment-content";
            contentDiv.textContent = c.content; // ä½¿ç”¨ textContent å®‰å…¨è®¾ç½®è¯„è®ºå†…å®¹

            // åˆ›å»ºdiv.comment-time
            const timeDiv = document.createElement("div");
            timeDiv.className = "comment-time";
            // æ—¶é—´ç”±æœåŠ¡å™¨ç”Ÿæˆï¼Œè™½ç„¶ä¸éœ€è¦è½¬ä¹‰ï¼ˆä¸åŒ…å«ç”¨æˆ·è¾“å…¥ï¼‰ï¼Œä½†ç”¨ textContent ä¹Ÿæ²¡é—®é¢˜
            timeDiv.textContent = c.created_at.replace('T', ' ').slice(0, 16);

            // å°†ä¸‰ä¸ª div æ·»åŠ åˆ° itemDiv ä¸­
            itemDiv.appendChild(nickDiv);
            itemDiv.appendChild(contentDiv);
            itemDiv.appendChild(timeDiv);

            // å°† itemDiv æ·»åŠ åˆ°è¯„è®ºåˆ—è¡¨å®¹å™¨
            commentList.appendChild(itemDiv);
          });
        });
    }
    

    document.getElementById("sendComment").onclick = () => {
      const now = Date.now();
      // â‘  é˜²æ­¢å¿«é€Ÿè¿ç‚¹ï¼ˆå®¢æˆ·ç«¯ï¼‰
      if (now - lastSubmitTime < MIN_INTERVAL) {
        alert("æäº¤å¤ªå¿«ï¼Œè¯·ç¨åå†è¯•ï¼");
        return;
      }

      const nickname = document.getElementById("nickname").value.trim();
      const content = document.getElementById("comment").value.trim();

      // â‘¡ ç©ºå€¼æ ¡éªŒ
      if (!nickname || !content) {
        alert("æ˜µç§°å’Œå†…å®¹ä¸èƒ½ä¸ºç©ºï¼");
        return;
      }

      // â‘¢ é•¿åº¦æ ¡éªŒï¼ˆå‰ç«¯ï¼‰
      if (nickname.length > 20) {
        alert("æ˜µç§°é•¿åº¦ä¸èƒ½è¶…è¿‡ 20 å­—ï¼");
        return;
      }
      if (content.length > 500) {
        alert("è¯„è®ºå†…å®¹ä¸èƒ½è¶…è¿‡ 500 å­—ï¼");
        return;
      }

      // â‘£ ç¦ç”¨æŒ‰é’®é˜²æ­¢è¿ç‚¹
      const btn = document.getElementById("sendComment");
      btn.disabled = true;
      btn.innerText = "æäº¤ä¸­â€¦";

      fetch(`/api/comments?post=${postId}`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          nickname,
          content
        })
      })
      .then(res => res.json())
      .then(res => {
        if (!res.ok) {
          alert(res.msg || "æäº¤å¤±è´¥ï¼Œè¯·ç¨åå†è¯•");
          return;
        }

        // é‡ç½®è¾“å…¥æ¡†
        document.getElementById("comment").value = "";
        lastSubmitTime = Date.now();
        loadComments();
      })
      .finally(() => {
        btn.disabled = false;
        btn.innerText = "æäº¤è¯„è®º";
      });
    };

    // æ±‰å ¡æŒ‰é’®æ˜¾ç¤º
    const hamburger = document.getElementById("hamburger");
    const menuList = document.getElementById("menuList");

    hamburger.addEventListener("click", () => {
      menuList.classList.toggle("show");
    });



    // åˆæ¬¡åŠ è½½è¯„è®º
    loadComments();

    initStars();
    draw();
  </script>
  
<!-- Live2Dï¼ˆCubism 3/4 æ¨¡å‹ï¼‰ -->
<script>
  const loadScript = (src) => new Promise((resolve, reject) => {
    const script = document.createElement("script");
    script.src = src;
    script.async = true;
    script.onload = () => resolve(src);
    script.onerror = () => reject(new Error(`è„šæœ¬åŠ è½½å¤±è´¥: ${src}`));
    document.head.appendChild(script);
  });

  const loadScriptWithFallback = async (sources, name) => {
    let lastError = null;

    for (const src of sources) {
      try {
        await loadScript(src);
        console.info(`[Live2D] ${name} åŠ è½½æˆåŠŸ: ${src}`);
        return src;
      } catch (error) {
        lastError = error;
        console.warn(`[Live2D] ${name} åŠ è½½å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€ä¸ªé•œåƒ: ${src}`);
      }
    }

    throw new Error(`${name} åŠ è½½å¤±è´¥ï¼ˆæ‰€æœ‰é•œåƒå‡ä¸å¯ç”¨ï¼‰: ${lastError?.message || "æœªçŸ¥é”™è¯¯"}`);
  };

  // Live2D è¿è¡Œåº“æœ¬åœ°åŒ–ï¼šé¿å…å¤–é“¾åœ¨ä¸åŒç½‘ç»œç¯å¢ƒä¸‹å¤±è´¥
  const runtimeSources = {
    pixi: ["/live2d/libs/pixi.min.js"],
    cubismCore: ["/live2d/libs/live2dcubismcore.min.js"],
    live2dDisplay: ["/live2d/libs/cubism4.min.js"]
  };

  const showLive2DStatus = (message) => {
    const old = document.getElementById("live2d-status");
    if (old) old.remove();

    const badge = document.createElement("div");
    badge.id = "live2d-status";
    badge.textContent = message;
    Object.assign(badge.style, {
      position: "fixed",
      left: "12px",
      bottom: "12px",
      zIndex: "1200",
      fontSize: "12px",
      lineHeight: "1.4",
      padding: "6px 8px",
      borderRadius: "8px",
      color: "#fff",
      background: "rgba(220, 53, 69, 0.88)",
      boxShadow: "0 4px 16px rgba(0,0,0,0.18)",
      pointerEvents: "none"
    });

    document.body.appendChild(badge);
  };

  window.addEventListener("load", async () => {
    const modelJsonPath = encodeURI("/live2d/å°æ¶µ_vts/å°æ¶µ .model3.json");
    const isMobile = /Android|iPhone|iPad|iPod|Mobi/i.test(navigator.userAgent);

    // æ‰‹æœºç«¯é»˜è®¤ä¸æ¸²æŸ“ï¼Œé¿å…é®æŒ¡æ­£æ–‡å†…å®¹
    if (isMobile) return;

    try {
      await loadScriptWithFallback(runtimeSources.pixi, "PIXI");
      await loadScriptWithFallback(runtimeSources.cubismCore, "Live2D Cubism Core");
      await loadScriptWithFallback(runtimeSources.live2dDisplay, "pixi-live2d-display");
    } catch (error) {
      console.error("Live2D è¿è¡Œåº“åŠ è½½å¤±è´¥ï¼š", error);
      showLive2DStatus("Live2D åŠ è½½å¤±è´¥ï¼ˆè¿è¡Œåº“ä¸å¯ç”¨ï¼‰");
      return;
    }

    if (!window.PIXI || !PIXI.live2d || !window.Live2DCubismCore) {
      console.error("Live2D è¿è¡Œåº“ä¸å®Œæ•´ï¼šè¯·æ£€æŸ¥ CDN æ˜¯å¦å¯è®¿é—®ã€‚");
      showLive2DStatus("Live2D åŠ è½½å¤±è´¥ï¼ˆè¿è¡Œåº“ä¸å®Œæ•´ï¼‰");
      return;
    }

    const viewWidth = Math.max(280, Math.min(380, Math.floor(window.innerWidth * 0.3)));
    const viewHeight = Math.max(420, Math.min(640, Math.floor(window.innerHeight * 0.72)));

    let app;
    try {
      app = new PIXI.Application({
        width: viewWidth,
        height: viewHeight,
        transparent: true,
        antialias: true,
        autoDensity: true,
        resolution: window.devicePixelRatio || 1
      });
    } catch (error) {
      console.error("Live2D æ¸²æŸ“å™¨åˆå§‹åŒ–å¤±è´¥ï¼š", error);
      showLive2DStatus("Live2D åŠ è½½å¤±è´¥ï¼ˆæµè§ˆå™¨ä¸æ”¯æŒ WebGLï¼‰");
      return;
    }

    if (app.renderer?.type !== PIXI.RENDERER_TYPE.WEBGL) {
      console.error("Live2D éœ€è¦ WebGL æ¸²æŸ“å™¨ï¼Œå½“å‰ä¸å¯ç”¨ã€‚");
      showLive2DStatus("Live2D åŠ è½½å¤±è´¥ï¼ˆWebGL ä¸å¯ç”¨ï¼‰");
      return;
    }

    Object.assign(app.view.style, {
      position: "fixed",
      left: "6px",
      bottom: "0",
      width: `${viewWidth}px`,
      height: `${viewHeight}px`,
      zIndex: "1000",
      pointerEvents: "none"
    });
    document.body.appendChild(app.view);

    try {
      const model = await PIXI.live2d.Live2DModel.from(modelJsonPath, {
        autoInteract: false
      });

      model.scale.set(1);
      const bounds = model.getLocalBounds();
      const scaleX = (app.renderer.width * 0.9) / Math.max(bounds.width, 1);
      const scaleY = (app.renderer.height * 0.96) / Math.max(bounds.height, 1);
      const fitScale = Math.min(scaleX, scaleY);
      model.scale.set(Math.max(0.08, Math.min(fitScale, 1.35)));

      model.position.set(
        app.renderer.width * 0.5 - (bounds.x + bounds.width * 0.5) * model.scale.x,
        app.renderer.height - (bounds.y + bounds.height) * model.scale.y
      );

      const updateFocus = (clientX, clientY) => {
        if (typeof model.focus !== "function") return;
        model.focus(clientX, clientY);
      };

      window.addEventListener("mousemove", (event) => {
        updateFocus(event.clientX, event.clientY);
      }, { passive: true });

      updateFocus(window.innerWidth / 2, window.innerHeight / 2);

      const skinStorageKey = "live2d-skin";
      const getSkinValue = (skinName) => skinName === "green" ? 1 : 0;
      let currentSkin = localStorage.getItem(skinStorageKey) || "green";

      const skinButton = document.createElement("button");
      skinButton.id = "live2d-skin-toggle";
      skinButton.type = "button";
      skinButton.ariaLabel = "åˆ‡æ¢ Live2D çš®è‚¤";
      Object.assign(skinButton.style, {
        position: "fixed",
        left: "14px",
        bottom: "14px",
        zIndex: "1100",
        width: "34px",
        height: "34px",
        border: "2px solid rgba(255, 255, 255, 0.9)",
        borderRadius: "50%",
        cursor: "pointer",
        boxShadow: "0 3px 10px rgba(0,0,0,0.25)"
      });

      const updateSkinButton = (skinName) => {
        skinButton.style.background = skinName === "green"
          ? "linear-gradient(135deg, #4fd66f, #24a148)"
          : "linear-gradient(135deg, #52b7ff, #2563eb)";
        skinButton.title = `å½“å‰çš®è‚¤ï¼š${skinName === "green" ? "ç»¿è‰²" : "è“è‰²"}ï¼ˆç‚¹å‡»åˆ‡æ¢ï¼‰`;
      };

      const applySkin = (skinName) => {
        const coreModel = model.internalModel?.coreModel;
        if (!coreModel || typeof coreModel.setParameterValueById !== "function") {
          return;
        }

        const skinValue = getSkinValue(skinName);
        coreModel.setParameterValueById("Param2", skinValue);
        coreModel.setParameterValueById("Param4", skinValue);
      };

      const switchSkin = (skinName) => {
        currentSkin = skinName;
        localStorage.setItem(skinStorageKey, skinName);
        applySkin(skinName);
        updateSkinButton(skinName);
      };

      skinButton.addEventListener("click", () => {
        switchSkin(currentSkin === "green" ? "blue" : "green");
      });
      document.body.appendChild(skinButton);

      app.ticker.add(() => {
        applySkin(currentSkin);
      });

      switchSkin(currentSkin);
      app.stage.addChild(model);
    } catch (error) {
      console.error("Live2D æ¨¡å‹åŠ è½½å¤±è´¥ï¼š", error);
      showLive2DStatus("Live2D åŠ è½½å¤±è´¥ï¼ˆæ¨¡å‹èµ„æºå¼‚å¸¸ï¼‰");
    }
  });
</script>



</body>
</html>
